# シナリオテスト仕様書

本ドキュメントは、システム全体のシナリオテスト仕様を記載します。

## 1. テスト対象
- S3バケットからCSVファイルをダウンロードし、データ検証・加工後、ZIP圧縮してS3へアップロードする一連のバッチ処理
- ログ出力、アップロードファイル（S3/Box）

## 2. シナリオ一覧

### シナリオ1: 正常系（CSVファイル1件）
- S3に1件のCSVファイルが存在
- ファイルをダウンロードし、検証・加工後、ZIP圧縮してS3へアップロード
- ログに処理開始・終了・警告（不正値があれば）を出力
- アップロードファイルが正しいことを確認

### シナリオ2: 正常系（CSVファイル複数件）
- S3に複数件のCSVファイルが存在
- すべてのファイルをダウンロードし、検証・加工後、グループごとにまとめてZIP圧縮しS3へアップロード
- ログに処理開始・終了・警告（不正値があれば）を出力
- アップロードファイルが正しいことを確認

### シナリオ3: S3にCSVファイルが存在しない
- 指定日付・プレフィックスに該当するCSVファイルがS3に存在しない
- ログに「ファイルなし」等の警告を出力
- エラー終了せずワーニングのみ出力（正常系）

### シナリオ4: 入力ファイルに不正値・欠損値が含まれる
- CSVファイル内に型不一致・日付不正・数値不正・NULL/空文字が含まれる
- 検証時にワーニングを出力し、不正値・欠損値は空文字に補完
- ログにワーニング内容を出力
- アップロードファイルが仕様通り補完されていることを確認

### シナリオ5: 入力ファイルに不要カラムが含まれる
- columns.txtに定義されていないカラムがCSVに含まれる
- 検証時に不要カラムを削除
- ログに不要カラム削除の記録（またはワーニング）を出力
- アップロードファイルに不要カラムが含まれていないことを確認

### シナリオ6: S3アップロード失敗
- S3へのアップロード時にエラーが発生
- ログにエラー内容を出力
- エラー終了することを確認

### シナリオ7: ZIP圧縮失敗
- ZIP圧縮時にエラーが発生（例: ファイルなし、権限エラー等）
- ログにエラー内容を出力
- エラー終了することを確認

### シナリオ8: Boxアップロード正常系
- S3アップロード後、Boxにもファイルをアップロード
- Boxアップロードが正常に完了し、ログに記録されていることを確認

### シナリオ9: Boxアップロード失敗
- Boxアップロード時にエラーが発生
- ログにエラー内容を出力
- エラー終了することを確認

## 3. シナリオ詳細

### シナリオ1: 正常系（CSVファイル1件）
- 前提: S3に test/2025-06-12_9000.csv が存在
- columns.txtに従い検証・加工
- 出力: 2025-06-12_test.csv, ZIP圧縮ファイル
- 証跡: ログ、S3アップロードファイル

### シナリオ2: 正常系（CSVファイル複数件）
- 前提: S3に test/2025-06-12_9000.csv, test/2025-06-12_9001.csv, test1/2025-06-12_9000.csv が存在
- グループごとに 2025-06-12_test.csv, 2025-06-12_test1.csv を出力
- 証跡: ログ、S3アップロードファイル

### シナリオ3: S3にCSVファイルが存在しない
- 前提: S3に該当ファイルなし
- ログに「ファイルなし」等の警告を出力
- エラー終了せずワーニングのみ出力

### シナリオ4: 入力ファイルに不正値・欠損値が含まれる
- 前提: CSVに型不一致・日付不正・数値不正・NULL/空文字が含まれる
- 検証時にワーニングを出力し、不正値・欠損値は空文字に補完
- 証跡: ログ、S3アップロードファイル

### シナリオ5: 入力ファイルに不要カラムが含まれる
- 前提: columns.txtに定義されていないカラムがCSVに含まれる
- 検証時に不要カラムを削除
- 証跡: ログ、S3アップロードファイル

### シナリオ6: S3アップロード失敗
- 前提: S3アップロード時にエラー発生
- ログにエラー内容を出力
- エラー終了

### シナリオ7: ZIP圧縮失敗
- 前提: ZIP圧縮時にエラー発生
- ログにエラー内容を出力
- エラー終了

### シナリオ8: Boxアップロード正常系
- 前提: Boxアップロードが正常に完了
- ログにアップロード成功を記録

### シナリオ9: Boxアップロード失敗
- 前提: Boxアップロード時にエラー発生
- ログにエラー内容を出力
- エラー終了

## 4. 証跡（ログ・アップロードファイル）
- ログ: 処理開始・終了、警告・エラー内容、ファイル有無、アップロード結果等を記録
- アップロードファイル: S3/Boxに出力されたファイル内容・件数・ファイル名を確認

## 5. 入出力ファイル仕様
- [BD_DD.md 4.1 入出力ファイルの仕様](./BD_DD.md#41-入出力ファイルの仕様)を参照
- 入力: グループ名/日付_時分.csv
- 出力: 日付_グループ名.csv（グループごとにまとめて出力）

## 6. 備考
- S3にCSVファイルが存在しない等、業務で発生しうる全てのパターンをシナリオに記載
- エラー終了せずワーニング出力する場合は正常系とする
- 入力ファイルが1件・複数件のパターンを用意し、入出力ファイル仕様を確認
