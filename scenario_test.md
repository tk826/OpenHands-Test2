# シナリオテスト仕様書

本仕様書は、システム全体のシナリオテストを記載するものであり、[BD_DD.md](./BD_DD.md)の設計内容に基づきます。

## 1. テスト対象
- AWS S3バケットからのCSVファイルダウンロード
- データ検証・警告出力・データ加工
- ZIP圧縮・S3アップロード
- 入出力ファイル仕様
- ログ・アップロードファイルの証跡

## 2. シナリオ一覧

### シナリオ1: 正常系（CSVファイル1件）
- S3に1件のCSVファイルが存在する
- ファイル名・内容ともに正しい
- columns.txtに従い全カラム正常
- データ検証・加工後、ZIP圧縮しS3へアップロード
- ログ・アップロードファイルを証跡として確認

### シナリオ2: 正常系（CSVファイル複数件）
- S3に複数件のCSVファイルが存在する
- ファイル名・内容ともに正しい
- columns.txtに従い全カラム正常
- データ検証・加工後、グループごとにまとめてZIP圧縮しS3へアップロード
- ログ・アップロードファイルを証跡として確認

### シナリオ3: 異常系（S3にCSVファイルが存在しない）
- 指定バケット・プレフィックス・日付に該当するCSVファイルが存在しない
- エラー終了せずワーニングを出力
- ログに「該当ファイルなし」等の記録が残る

### シナリオ4: 異常系（CSVファイル名不正）
- S3に日付形式でないファイル名のCSVが存在
- 不正ファイルは無視し、ワーニングを出力
- 正常ファイルのみ処理

### シナリオ5: 異常系（カラム不正・欠損値・型不一致）
- columns.txtにないカラムが存在
- 型不一致（例: 日付型に不正値、数値型に文字列等）
- 欠損値（NaN, None, 空文字）
- 不正値・欠損値は空文字に補完、ワーニング出力
- columns.txtにないカラムは削除
- エラー終了せず正常系として処理

### シナリオ6: 異常系（S3アップロード失敗）
- S3へのアップロード時に一時的なエラー発生
- リトライ処理またはワーニング出力
- 最終的にアップロード失敗時はログに記録

## 3. 入出力ファイル仕様確認パターン
- 入力ファイルが1件、複数件、0件（異常系）
- グループごとにファイルが分かれる場合
- columns.txtの型定義ごとに正常・異常値を含むパターン

## 4. 証跡確認内容
- ログファイル（ダウンロード・検証・加工・アップロード・ワーニング等）
- S3アップロードファイル（ZIP/CSV）
- ワーニング出力内容

## 5. 備考
- エラー終了せずワーニングのみの場合は正常系とする
- 業務で発生しうる全てのパターンを網羅
- columns.txt・.env等の設定ファイルもテスト時に確認
