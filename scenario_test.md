# シナリオテスト仕様書

本ドキュメントは、システム全体のシナリオテスト仕様を記載します。

## 1. テスト対象
- AWS S3バケットからのCSVファイルダウンロード
- データ検証・加工・警告出力
- ZIP圧縮・S3アップロード

## 2. シナリオ一覧

### シナリオ1: 正常系（CSVファイルが1件存在し、全て正常データ）
- S3に1件のCSVファイル（正しい形式・データ）が存在
- ダウンロード・検証・加工・ZIP圧縮・アップロードまで正常終了
- 証跡: ログにエラー・ワーニングなし、アップロードファイルが正しい

### シナリオ2: 正常系（CSVファイルが複数件存在し、全て正常データ）
- S3に複数件のCSVファイル（正しい形式・データ）が存在
- 全ファイルがダウンロード・検証・加工・ZIP圧縮・アップロードまで正常終了
- 証跡: ログにエラー・ワーニングなし、アップロードファイルが正しい

### シナリオ3: 正常系（CSVファイルにワーニング対象データが含まれる）
- S3に1件以上のCSVファイルが存在し、一部に型不一致・不正値・空文字・NULLが含まれる
- 検証時にワーニングが出力されるが、処理は継続し正常終了
- 証跡: ログにワーニング出力、アップロードファイルは不正値が空文字に補完されている

### シナリオ4: 異常系（S3にCSVファイルが存在しない）
- 指定バケット・プレフィックス・日付に該当するCSVファイルが存在しない
- ワーニングを出力し、エラー終了せずに処理継続
- 証跡: ログに「CSVファイルが存在しません」等のワーニング出力、アップロードファイルなし

### シナリオ5: 異常系（CSVファイルの一部が壊れている/読み込めない）
- S3に存在するCSVファイルの一部が壊れている、または読み込み不可
- 壊れているファイルのみワーニング出力し、他ファイルは正常処理
- 証跡: ログに該当ファイルのワーニング出力、正常ファイルのみアップロード

### シナリオ6: 異常系（columns.txtに存在しないカラムがCSVに含まれる）
- CSVファイルにcolumns.txtに定義されていないカラムが含まれる
- 不要カラムは削除し、処理継続
- 証跡: ログに不要カラム削除の記録（必要に応じて）、アップロードファイルは不要カラムなし

### シナリオ7: 異常系（環境変数の未設定）
- 必須環境変数（SRC_BUCKET等）が未設定
- エラー出力し、処理中断
- 証跡: ログにエラー出力、アップロードファイルなし

## 3. 入出力ファイル仕様確認パターン
- 入力ファイルが1件の場合、複数件の場合でそれぞれ上記シナリオを実施
- 出力ファイル名・内容が仕様通りであることを確認

## 4. 証跡対象
- ログ出力内容（エラー・ワーニング・正常メッセージ）
- S3へのアップロードファイル（ZIP/CSV）

## 5. 備考
- ワーニングのみの場合は正常系とみなす
- 業務で発生しうる全てのパターンを網羅
