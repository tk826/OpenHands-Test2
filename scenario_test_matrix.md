# シナリオテスト仕様書（マトリクス形式）

## 1. 目的
本ドキュメントは、システム全体のシナリオテストを網羅的に記載し、業務フローの最初から最後までの動作確認を行うことを目的とする。

## 2. 参照元
- [BD_DD.md](./BD_DD.md)
- [41-入出力ファイルの仕様](./BD_DD.md#41-%E5%85%A5%E5%87%BA%E5%8A%9B%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BB%95%E6%A7%98)

## 3. シナリオテストマトリクス

| シナリオNo | シナリオ概要 | 入力ファイル件数 | S3ファイル有無 | 想定処理 | 証跡（ログ/アップロードファイル） | エラー/ワーニング | 備考 |
|------------|--------------|------------------|---------------|----------|-------------------------------|-------------------|------|
| 1 | 正常系: S3に1件CSVあり | 1 | あり | ダウンロード→検証→ZIP→S3アップロード | ログ:全処理正常, S3:ZIP/CSV出力 | なし | 基本正常系 |
| 2 | 正常系: S3に複数CSVあり | 複数 | あり | ダウンロード→検証→ZIP→S3アップロード | ログ:全処理正常, S3:ZIP/CSV出力 | なし | 複数グループ/日付パターン |
| 3 | 正常系: S3にCSVが存在しない | 0 | なし | ワーニング出力のみ | ログ:ワーニング, S3:出力なし | ワーニング | ファイルなし業務パターン |
| 4 | 正常系: CSVに不正値（型不一致/日付不正等） | 1 | あり | ダウンロード→検証→ワーニング出力→ZIP→S3アップロード | ログ:ワーニング, S3:ZIP/CSV出力 | ワーニング | 不正値は空文字補完 |
| 5 | 正常系: CSVに欠損値/空文字/NULL | 1 | あり | ダウンロード→検証→空文字補完→ZIP→S3アップロード | ログ:ワーニング, S3:ZIP/CSV出力 | ワーニング | 欠損値は空文字補完 |
| 6 | 正常系: 不要カラム含むCSV | 1 | あり | ダウンロード→検証→不要カラム削除→ZIP→S3アップロード | ログ:全処理正常, S3:ZIP/CSV出力 | なし | columns.txtにないカラム |
| 7 | 正常系: 入力ファイル名/出力ファイル名仕様違反 | 1 | あり | ワーニング出力→処理継続 | ログ:ワーニング, S3:ZIP/CSV出力 | ワーニング | ファイル名不正 |
| 8 | 異常系: S3/AWS認証エラー | - | - | エラー終了 | ログ:エラー | エラー | AWS認証情報不備 |
| 9 | 異常系: S3アップロード失敗 | 1 | あり | エラー終了 | ログ:エラー | エラー | S3書込権限なし等 |
| 10 | 異常系: ローカルディスク容量不足 | 1 | あり | エラー終了 | ログ:エラー | エラー | 一時ファイル作成不可 |

## 4. シナリオ詳細
- 各シナリオは、処理の最初から最後まで（S3ダウンロード→検証→ZIP圧縮→S3アップロード）を通しで実施する。
- 証跡はログ出力およびS3/アップロードファイルの有無・内容を確認対象とする。
- S3にCSVファイルが存在しない場合や、業務で発生しうる全パターン（ファイル不在、認証エラー、権限エラー等）を網羅する。
- エラー終了せずワーニングのみ出力する場合は正常系とする。
- 入力ファイルは1件/複数件のパターンを用意し、[41-入出力ファイルの仕様](./BD_DD.md#41-%E5%85%A5%E5%87%BA%E5%8A%9B%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BB%95%E6%A7%98)を参照する。

## 5. 補足
- 本マトリクスは今後の仕様追加・変更時に随時更新する。
